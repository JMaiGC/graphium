# Finetune task
task: lipophilicity_astrazeneca
level: graph

# Pretrained model
pretrained_model: dummy-pretrained-model-gpu
finetuning_module: task_heads                # options are (pre_nn, pre_nn_edges) gnn, graph_output_nn, task_heads, finetunehead
task_head_from_pretrained: zinc # none            # (only needed when finetuning from task_heads)
                                                  # choose one from pretrained model (here qm9, tox12 or zinc)
drop_depth: 1                                     # how many layers to drop at the end:
                                                  # must be smaller than pretrained model's depth
                                                  # for TaskHeads:
                                                  #   ==0 only if finetune task has same out_dim
                                                  #   >=1 otherwise, as we need to update out_dim  

# Changes to finetuning model                     # here we simply extend the layer, we finetune from
new_out_dim: 8
added_depth: 2

# Optional finetuning head appended to model after finetuning_module
finetuning_head:
  task: lipophilicity_astrazeneca
  previous_module: task_heads
  incoming_level: graph
  model_type: mlp
  in_dim: 8
  out_dim: 1
  hidden_dims: 8
  depth: 2
  last_layer_is_readout: true

# Training
unfreeze_pretrained_depth: 0                         # if desired, we can also finetune layers before added layers
epoch_unfreeze_all: none                          # Indicate an epoch to unfreeze all layers






# Changes to be implemented

# predictor:
# ### Changes for finetuning ##############################
#   metrics_on_progress_bar:
#     lipophilicity_astrazeneca: ["mae"]
#   loss_fun:
#     lipophilicity_astrazeneca: mae
# #########################################################
# ## Changes for finetuning ##############################
#   metrics:
#     lipophilicity_astrazeneca:
#       - name: mae
#         metric: mae
#         target_nan_mask: null
#         multitask_handling: flatten
#         threshold_kwargs: null
#       - name: spearman
#         metric: spearmanr
#         threshold_kwargs: null
#         target_nan_mask: null
#         multitask_handling: mean-per-label
#       - name: pearson
#         metric: pearsonr
#         threshold_kwargs: null
#         target_nan_mask: null
#         multitask_handling: mean-per-label
#       - name: r2_score
#         metric: r2
#         target_nan_mask: null
#         multitask_handling: mean-per-label
#         threshold_kwargs: null
# #########################################################

# datamodule:
# ### Changes for finetuning ##############################
#   module_type: "ADMETBenchmarkDataModule"
#   args:
#     # TDC specific
#     tdc_benchmark_names: [lipophilicity_astrazeneca]
#     tdc_train_val_seed: ${constants.seed}
# #########################################################